# 需求功能点列表

> 用于需求深入沟通的功能点整理文档w

## 1. 强制更新 App 版本功能

### 功能描述

当 App 版本太旧时，强制用户更新才能继续用，不更新就完全用不了。

### 功能点

- **版本检查机制** 【前后端】
- 前端：App 启动时和从背景切回前景时，调用后端 API 检查版本
- 后端：提供最低版本号配置（min_supported_version），返回是否需要更新
- 前端：正确比较版本号（别用字符串直接比，容易出错）

- **前景阻挡式更新提示** 【前端】
- 显示全屏或不可关闭的弹窗，挡住所有操作
- 不能返回、不能关闭、不给"稍后更新"选项
- 只有一个"立即更新"按钮，点了直接跳 App Store/Google Play
- 背景的数据同步可以继续跑，但 UI 上啥都不能点

- **推播通知（可选）** 【后端+前端】
- 后端：当检测到用户版本过旧且 App 在背景时，发送推播通知
- 前端：点击推播直接跳商店，不先开 App

### 需要确认的关键点

- [ ] 最低版本号配置方式（后端 API/远程配置/配置文件）
- [ ] 版本号格式规范（如：1.0.0, 1.0.1 等）
- [ ] 推播通知是否必须实现，还是可选功能
- [ ] 背景数据同步的哪些流程需要允许完成
- [ ] iOS 和 Android 的商店跳转 URL 格式

---

## 2. Email 验证功能（SMS 优先 + Email 备援）

### 功能描述

在现有 SMS 验证基础上，加个 Email 验证当备选。用户先试 SMS，不行再用 Email，两个有一个成功就算验证通过。

### 功能点

- **SMS 验证流程（主流程）** 【前后端】
- 前端：用户输手机号，点发送
- 后端：发送 SMS 验证码
- 前端：发送成功就显示"验证码已发至手机"，进验证码输入页，显示倒计时；发送失败就显示错误提示，让用户重试
- 前端：验证码输入页有倒计时和重发按钮
- 后端：验证用户输入的验证码

- **Email 验证流程（备援）** 【前后端】
- 前端：在 SMS 验证码输入页下方显示"透过 Email 验证"按钮
- 前端：用户点按钮后进 Email 输入页
- 后端：发送 Email 验证码
- 前端：发送成功显示"验证码已发至 Email（记得检查垃圾邮件匣）"，发送失败显示错误提示
- 前端：Email 验证码输入页也有倒计时和重发
- 后端：验证 Email 验证码

- **验证完成判定** 【后端】
- SMS 或 Email 任一验证成功就算完成，后续注册流程不再要求重复验证

- **错误处理** 【前后端】
- 后端：返回各种错误状态（验证码错误、过期、次数过多、网络错误等）
- 前端：每种错误都要显示人看得懂的提示，并告诉用户下一步该干嘛（重试/等待/改用 Email）

### 需要确认的关键点

- [ ] SMS 和 Email 验证码的有效期时长
- [ ] 重发验证码的倒计时时长和频率限制
- [ ] 验证码错误次数上限
- [ ] Email 验证码的格式要求（是否与 SMS 一致）
- [ ] 后端 API 接口设计（发送验证码、验证验证码）
- [ ] 现有 SMS 验证流程是否需要调整

---

## 3. 注册流程调整：使用者条款独立页面

### 功能描述

把使用者条款从弹窗改成独立页面，放在建立账号密码之后、验证之前。用户必须勾选同意才能继续。

### 功能点

- **新注册流程顺序** 【前端】

1. 建立账号与密码
2. 显示使用者条款/隐私政策独立页面（不是弹窗）
3. 用户必须勾选同意
4. 才能进入验证流程（SMS/Email）

- **条款页面功能** 【前后端】
- 前端：独立页面，条款内容可滚动阅读，必须勾选才能继续，返回上一页时保留已填的账号密码
- 后端：提供条款内容（如果需要从后端获取），记录用户同意状态和时间

### 需要确认的关键点

- [ ] 条款内容来源（后端 API/本地文件/远程 URL）
- [ ] 是否需要支持多语言版本
- [ ] 条款页面是否需要支持版本管理（用户已同意旧版本，是否需要重新同意新版本）
- [ ] 返回上一页时，已填写的账号密码是否需要保留
- [ ] 条款页面是否需要记录用户同意时间等审计信息

---

## 4. 个人资讯页需求

### 功能描述

注册时的个人资讯页和注册后的个人资讯页是两回事：注册时必须填完才能继续，注册后想填就填，不填也能用 App。

### 功能点

- **注册流程中的个人资讯页（精简、必填）** 【前后端】
- 前端：只显示必要栏位（就寝时间 + 其他必要栏位），所有栏位必填，没填完不能继续注册
- 前端：只检查有没有填，不检查格式对不对
- 后端：接收并保存注册时的个人资讯

- **注册完成后的个人资讯页（完整、非必填）** 【前后端】
- 前端：显示完整个人资讯栏位（就寝时间、运动习惯等），不强制必填
- 前端：可以留空或只改部分栏位，点保存就直接存，不会因为没填完就挡着
- 后端：提供个人资讯的查询和更新接口

- **共用栏位一致性** 【前端】
- 就寝时间：两个页面都用时间选择器，名字一样，只是注册时必填、注册后可选
- 运动习惯：只在注册后的页面有，注册流程页没有，只能用固定选项，不能自由输入

### 需要确认的关键点

- [ ] 注册流程中个人资讯页的具体必填栏位列表（除就寝时间外还有哪些）
- [ ] 注册完成后个人资讯页的完整栏位列表
- [ ] 运动习惯的固定选项有哪些（需要后端提供选项列表）
- [ ] 就寝时间的输入方式（时间选择器格式：12 小时制/24 小时制）
- [ ] 个人资讯数据的存储和同步机制
- [ ] 注册时填写的个人资讯如何在注册完成后正确显示

---

## 5. 资料进入即时刷新页面

### 功能描述

戒指、体脂秤等设备有新数据进来时，App 页面要自动刷新显示最新数据，不用用户手动刷新。

### 功能点

- **数据监听机制** 【前后端】
- 后端：设备上报数据到服务端（戒指、体脂秤等）
- 后端：当有新数据时，通知前端（WebSocket/推送/轮询等方式）
- 前端：监听数据更新，自动刷新相关页面

- **刷新时机** 【前端】
- App 在前景时：有新数据就刷新
- App 从背景切回前景时：检查并刷新最新数据
- 用户正在看数据页面时：实时更新

- **性能优化** 【前端】
- 避免画面闪烁或重复渲染
- 注意电量和性能消耗，别让 App 变卡

### 需要确认的关键点

- [ ] 数据监听方式（WebSocket/轮询/推送通知/其他）
- [ ] 哪些页面需要实时刷新（数据展示页、首页、个人中心等）
- [ ] 刷新频率和延迟要求（即时/准即时的时间范围）
- [ ] 是否需要区分不同装置类型的数据更新
- [ ] 网络异常时的处理机制（离线数据缓存、重连机制等）
- [ ] 是否需要显示数据同步状态提示

---

## 6. 咨询聊天室 - 档案上传

### 功能描述

在咨询聊天室加个上传功能，可以传食物照片或健检报告。第一次上传要签隐私同意书，可以同时传图片和文字，后端 AI 会自动识别文件类型并提取数据。

### 功能点

- **触发与选单** 【前端】
- 输入框左侧有个 ➕ 按钮，点开显示选单（拍照、选图片、选档案）

- **隐私授权闸门（首次上传限定）** 【前后端】
- 后端：检查用户 Profile 里的 is_upload_policy_agreed 标记
- 前端：如果没同意过，就弹出强制 Modal，显示隐私和 AI 分析授权说明，用户必须点"同意并继续"才能上传
- 后端：用户同意后更新标记为 True
- 前端：如果已同意，直接开相机/相簿/档案管理器

- **预览与文字输入** 【前端】
- 用户选完照片或档案后，在输入框上方显示缩图预览
- 每张缩图右上角有 X 可以删除
- 用户可以在输入框里同时输入文字说明
- 点发送后，图片和文字打包一起发给后端

- **聊天室显示** 【前端】
- 图片气泡在上，文字气泡在下（或合并显示）

- **后端 AI 自动分流** 【后端】
- 自动判断文件类型（食物照片/健检报告）
- 根据类型提取对应数据（L0~L6）

### 需要确认的关键点

- [ ] 支持的文件类型和大小限制（图片格式、PDF、其他）
- [ ] 单次上传文件数量限制
- [ ] 隐私授权同意书的具体内容（需要法务确认）
- [ ] 后端 AI 分流的 L0~L6 数据提取规则和格式
- [ ] 上传进度显示和失败重试机制
- [ ] 图片压缩和优化策略（前端压缩/后端处理）
- [ ] 健检报告的去识别化处理流程
- [ ] 食物照片的 AI 辨识功能范围
- [ ] 上传后的数据存储位置和访问权限

---

## 技术架构相关确认点

### 前端（Flutter）

- [ ] 现有 Flutter 版本和依赖包版本
- [ ] 是否需要新增第三方 SDK（如文件选择器、图片处理等）
- [ ] 状态管理方案（Provider/Bloc/其他）

### 后端（Java）

- [ ] 现有 Java 框架和版本
- [ ] 新增 API 接口的设计规范
- [ ] 数据库表结构是否需要调整
- [ ] 文件存储方案（AWS S3/其他）

### 云服务（AWS）

- [ ] 现有 AWS 服务架构
- [ ] 是否需要新增 AWS 服务（如 S3 存储、SNS 推播等）
- [ ] 部署和发布流程

### 数据同步

- [ ] 现有设备数据上报机制
- [ ] 戒指和体脂秤的数据格式和上报频率
